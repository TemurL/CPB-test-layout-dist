(()=>{"use strict";const e=document.querySelectorAll(".logic__add-logic"),t=e=>{e.currentTarget.parentElement.parentElement.remove()},s=e=>{let s=+e.currentTarget.dataset.rulesQty;const o=document.createElement("div");var i;o.classList.add("logic__rule"),o.innerHTML=`\n    <div class="logic__rule-content">\n        <label for="logic__select_${i=s+1}">If Customer Selects:</label>\n        <select name="logic__select_${i}" id="logic__select_${i}">\n            <option value="none">Do Not select</option>\n            <option value="other">Other</option>\n            <option value="other">Other</option>\n        </select>\n        <p class="discription">This Element Should Be:</p>\n        <div class="input-wrapper"><input type="radio" name="logic__state_${i}" id="logic__hidden_${i}" checked><label for="logic__hidden_${i}">Hidden</label></div>\n        <div class="input-wrapper"><input type="radio" name="logic__state_${i}" id="logic__shown_${i}"><label for="logic__shown_${i}">Shown</label></div>\n    </div>\n    <div class="logic__rule-actions">\n        <img src="./img/logic/copy.svg" alt="" class="logic__copy-button" id="logic__copy-button_${i}">\n        <img src="./img/logic/delete.svg" alt="" class="logic__delete-button" id="logic__delete-button_${i}">\n    </div>\n    `,e.currentTarget.dataset.rulesQty=s+1,e.currentTarget.insertAdjacentElement("beforebegin",o),o.querySelector(".logic__delete-button").addEventListener("click",t)},o=new class{constructor(){this.layoutLayers=document.querySelector(".menu__edit-layers"),this.layoutOptions=document.querySelector(".menu__edit-options"),this.layerEditorWrapper=document.querySelector(".layer-editor-wrapper"),this.showLayersBtn=document.querySelector("#edit-layers"),this.createLayerBtn=document.getElementById("create-layer"),this.layersList=document.querySelector(".edit-layers__layers-list"),this.layoutMenu=document.querySelector(".layout__menu"),this.editLayersCloseButton=document.querySelector(".edit-layers__close-button"),this.layerEditorWindowCloseBtn=document.querySelector(".layer-editor-window__close-button"),this.applyBtn=document.querySelector(".layer-editor__action-button#apply"),this.cancelBtn=document.querySelector(".layer-editor__action-button#cancel"),this.layerEditorWindowElem=document.getElementsByClassName("layer-editor-window")[0],this.workspace=document.querySelector(".preview-container__workspace"),this.headerPanel=document.getElementById("header-panel"),this.layerEditorWindowIsOpen=!1,this.layoutLayersIsOpen=!1,this.actions={getLayersUl:()=>document.querySelectorAll(".edit-layers .layers-list__layer-item"),clickHandlerForLayerLi:e=>{e.currentTarget.classList.contains("open-edit")||(Array.from(this.actions.getLayersUl()).forEach((e=>{e.classList.contains("open-edit")&&e.classList.remove("open-edit")})),e.currentTarget.classList.add("open-edit"),this.actions.openEditor())},cleanSelectionFromLayers:()=>{Array.from(this.actions.getLayersUl()).forEach((e=>{e.classList.contains("open-edit")&&e.classList.remove("open-edit"),this.actions.closeEditor()}))},showLayoutLayers:()=>{this.linkLayersObject.isOpen&&this.linkLayersObject.close(),this.layoutOptions.classList.remove("open"),this.layoutLayers.classList.add("open"),Array.from(this.showLayersBtn.parentElement.children).forEach((e=>{e.classList.contains("active")&&e.classList.remove("active")})),this.showLayersBtn.classList.add("active"),this.layoutLayersIsOpen=!0},hideLayoutLayers:()=>{this.linkLayersObject.isOpen&&this.linkLayersObject.close(),this.layoutOptions.classList.add("open"),this.layoutLayers.classList.remove("open"),this.showLayersBtn.classList.remove("active"),this.createLayerBtn.classList.remove("active"),this.actions.cleanSelectionFromLayers(),this.actions.closeLayerEditorWindow(),this.layoutLayersIsOpen=!1,this.layerEditorWindowIsOpen=!1},createLayer:()=>{this.createLayerBtn.classList.add("active"),this.showLayersBtn.classList.remove("active");const e=document.createElement("li");e.classList.add("layers-list__layer-item"),e.dataset.layerType="image-area",e.textContent="New Layer Title",this.layersList.appendChild(e),e.addEventListener("click",this.actions.clickHandlerForLayerLi),e.click(),this.layoutLayersIsOpen=!0,this.layerEditorWindowIsOpen=!0},switchShowLayersBtnToActive:()=>{this.linkLayersObject.isOpen&&this.linkLayersObject.close(),this.actions.cleanSelectionFromLayers(),this.showLayersBtn.classList.add("active"),this.createLayerBtn.classList.remove("active"),this.layoutLayersIsOpen=!0,this.layerEditorWindowIsOpen=!1},closeLayerEditorWindow:()=>{let e=this.layerEditorWindowElem.clientHeight;this.layerEditorWindowElem.style.setProperty("--top",`-${e}px`),this.layerEditorWindowElem.classList.remove("open"),this.layerEditorWindowIsOpen=!1},openLayerEditorWindow:()=>{this.linkLayersObject.isOpen&&this.linkLayersObject.close(),this.layerEditorWindowElem.style.setProperty("--top",`${this.headerPanel.clientHeight}px`),this.layerEditorWindowElem.classList.add("open"),this.layerEditorWindowIsOpen=!0},openEditor:()=>{document.querySelector(".layer-editor-wrapper").classList.add("open"),document.querySelector(".edit-layers__close-button").classList.add("hidden"),this.actions.openLayerEditorWindow()},closeEditor:()=>{document.querySelector(".layer-editor-wrapper").classList.remove("open"),document.querySelector(".edit-layers__close-button").classList.remove("hidden"),this.actions.closeLayerEditorWindow()},setWidthLayerEditorWindow:()=>{let e=this.workspace.clientWidth;this.layerEditorWindowElem.style.width=e-1+"px"},setPositionLayerEditorWindow:()=>{const e=this.workspace.getBoundingClientRect();let t=e.left;this.layerEditorWindowElem.style.setProperty("--preview-left",`${t+2}px`),this.layerEditorWindowElem.style.setProperty("--top",`${this.headerPanel.clientHeight}px`),this.layerEditorWindowElem.style.setProperty("--max-height",e.top+e.height-this.headerPanel.clientHeight+"px")},switchTabsHandlerLayerEditorWindow:()=>{const e=this.layerEditorWindowElem.querySelectorAll(".layer-editor-window__tab"),t=this.layerEditorWindowElem.querySelectorAll(".layer-editor-window__content");e.forEach(((s,o)=>{s.addEventListener("click",(s=>{let i=s.currentTarget;i.classList.contains("selected")||(e.forEach(((e,s)=>{e.classList.contains("selected")&&(e.classList.remove("selected"),t[s].classList.remove("open"))})),i.classList.add("selected"),t[o].classList.add("open"))}))}))},setLayerEditorHeightAssCssProp:()=>{let e;new ResizeObserver((t=>{t.forEach((()=>{e=this.layerEditorWrapper.clientHeight,this.layoutLayers.style.setProperty("--layer-editor-height",`${e}px`)}))})).observe(this.layerEditorWrapper)}},this.init=()=>{this.showLayersBtn.addEventListener("click",(()=>{this.layoutLayersIsOpen&&(this.layerEditorWindowIsOpen||this.linkLayersObject.isOpen)?this.actions.switchShowLayersBtnToActive():this.layoutLayersIsOpen?this.actions.hideLayoutLayers():this.actions.showLayoutLayers()})),this.createLayerBtn.addEventListener("click",(()=>{this.layoutLayersIsOpen||this.actions.showLayoutLayers(),this.actions.createLayer()})),this.layerEditorWindowCloseBtn.addEventListener("click",(e=>{this.actions.switchShowLayersBtnToActive()})),this.applyBtn.addEventListener("click",(e=>{this.actions.switchShowLayersBtnToActive()})),this.cancelBtn.addEventListener("click",(e=>{this.actions.switchShowLayersBtnToActive()})),this.editLayersCloseButton.addEventListener("click",(e=>{this.actions.hideLayoutLayers(),this.actions.cleanSelectionFromLayers()})),this.actions.setWidthLayerEditorWindow(),this.actions.setPositionLayerEditorWindow(),this.actions.closeLayerEditorWindow(),this.actions.switchTabsHandlerLayerEditorWindow(),window.onresize=()=>{this.actions.setWidthLayerEditorWindow(),this.actions.setPositionLayerEditorWindow()},this.actions.setLayerEditorHeightAssCssProp(),Array.from(this.actions.getLayersUl()).forEach((e=>{e.addEventListener("click",this.actions.clickHandlerForLayerLi)})),this.linkLayersObject.init(),console.log("Layers were init")},this.linkLayersObject={linkLayersWrapper:document.getElementsByClassName("layer-manager__link-layers-wrapper")[0],linkLayersBtn:document.getElementById("link-layers"),layerUlIn:document.getElementsByClassName("link-layers__layers-list")[0],layerUlOut:document.getElementsByClassName("edit-layers__layers-list")[0],customOptionsUlIn:document.getElementsByClassName("link-layers__options-list")[0],getCustomOptionsFromOpenStep:()=>document.querySelector(".steps__step-content.open").children,isOpen:!1,contentType:"layers",listItemClickHandler:e=>{console.log(e.target)},docMouseMoveHandler:e=>{const t=document.querySelector(".drag-layer-player");t.style.setProperty("--pos-x",e.clientX+scrollX+"px"),t.style.setProperty("--pos-y",e.clientY+scrollY+"px")},listItemMouseDownHandler:e=>{console.log(e);let t=e.target;if("auto"===t.dataset.layerType)return t.classList.add("dont-drag"),void addEventListener("mouseup",(()=>{t.classList.remove("dont-drag")}));t.classList.add("dragging");const s=document.createElement("div");s.classList.add("drag-layer-player"),s.style.setProperty("--pos-x",e.clientX+scrollX+"px"),s.style.setProperty("--pos-y",e.clientY+scrollY+"px"),document.body.classList.add("dragging-layer-thumb"),addEventListener("mousemove",this.linkLayersObject.docMouseMoveHandler),addEventListener("mouseup",(e=>{removeEventListener("mousemove",this.linkLayersObject.docMouseMoveHandler),s.style.animationName="scaleOut",setTimeout((()=>{s.remove()}),350),t.classList.add("connected"),t.classList.remove("dragging"),document.body.classList.remove("dragging-layer-thumb")})),document.body.appendChild(s)},linkLayersBtnClickHandler:e=>{this.linkLayersObject.isOpen?this.linkLayersObject.close():this.linkLayersObject.open()},updateList:()=>{if("layers"===this.linkLayersObject.contentType){this.linkLayersObject.customOptionsUlIn.classList.add("hidden"),this.linkLayersObject.layerUlIn.classList.remove("hidden");let e=this.actions.getLayersUl().length,t=this.linkLayersObject.layerUlIn.children.length;if(t<e){let s;for(let o=t;o<e;o++)s=this.linkLayersObject.layerUlOut.children[o].cloneNode(!0),s.addEventListener("click",this.linkLayersObject.listItemClickHandler),s.addEventListener("mousedown",this.linkLayersObject.listItemMouseDownHandler),this.linkLayersObject.layerUlIn.appendChild(s),console.log(`addind layer ${o}...`)}else if(t>e)for(let s=0;s<t-e;s++)this.linkLayersObject.layerUlIn.children[s].remove(),console.log(`removing layer ${s}...`)}else{console.log("updating options"),this.linkLayersObject.customOptionsUlIn.classList.remove("hidden"),this.linkLayersObject.layerUlIn.classList.add("hidden");let e=this.linkLayersObject.getCustomOptionsFromOpenStep().length,t=this.linkLayersObject.customOptionsUlIn.children.length;if(t<e){let s;for(let o=t;o<e;o++)s=this.linkLayersObject.getCustomOptionsFromOpenStep()[o].cloneNode(!0),s.querySelector(".custom-option__row_actions").remove(),s.querySelectorAll(".custom-option__color-choice").forEach((e=>e.addEventListener("mousedown",this.linkLayersObject.listItemMouseDownHandler))),s.querySelector(".custom-option__add-layer-button").addEventListener("mousedown",this.linkLayersObject.listItemMouseDownHandler),s.classList.add("collapsed"),s.id+="-link",s.querySelector(".custom-option__collapse-button").addEventListener("click",(e=>{const t=e.currentTarget.closest(".custom-option");console.log(t),t.classList.contains("collapsed")?t.classList.remove("collapsed"):t.classList.add("collapsed")})),this.linkLayersObject.customOptionsUlIn.appendChild(s),console.log(`addind option ${o}...`)}else if(t>e)for(let s=0;s<t-e;s++)this.linkLayersObject.customOptionsUlIn.children[s].remove(),console.log(`removing option ${s}...`)}},open:()=>{this.layoutLayersIsOpen?this.linkLayersObject.contentType="options":this.linkLayersObject.contentType="layers",this.layerEditorWindowIsOpen&&(this.actions.closeLayerEditorWindow(),this.actions.cleanSelectionFromLayers()),this.linkLayersObject.updateList(),this.linkLayersObject.linkLayersWrapper.classList.add("open"),this.linkLayersObject.isOpen=!0},close:()=>{this.linkLayersObject.linkLayersWrapper.classList.remove("open"),this.linkLayersObject.isOpen=!1},init:()=>{this.linkLayersObject.updateList(),this.linkLayersObject.linkLayersBtn.addEventListener("click",this.linkLayersObject.linkLayersBtnClickHandler),console.log("linkLayers was init")}}}};document.querySelectorAll("form button").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault()}))})),function(e){let t=new Image;t.onload=t.onerror=function(){(e=>{let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)})(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}(),(()=>{const e=document.querySelector(".header-panel__func-btns"),t=e=>{const t=e.target,s=e.currentTarget;s.querySelector(".selected")?.classList.remove("selected"),t.classList.toggle("selected")};document.querySelector(".header-panel__preview-modes").addEventListener("click",t),e.addEventListener("click",t)})(),(()=>{const e=document.getElementsByClassName("workspace__canvas")[0],t=document.querySelector(".workspace__size-button#bigger"),s=document.querySelector(".workspace__size-button#smaller"),o=document.querySelector(".workspace__select-size"),i=document.querySelector(".select-size__dropdown"),r=t=>{"bigger"==t.currentTarget.id?(e.style.setProperty("--set-scale",+getComputedStyle(e).scale+.2),o.querySelector("span").textContent=`${Math.max(Math.floor(100*(+getComputedStyle(e).scale+.2)),0)}%`):(e.style.setProperty("--set-scale",+getComputedStyle(e).scale-.2),o.querySelector("span").textContent=`${Math.max(Math.floor(100*(+getComputedStyle(e).scale-.2)),0)}%`)};t.addEventListener("click",r),s.addEventListener("click",r),e.addEventListener("mousedown",(e=>{const t=()=>{o.removeEventListener("mousemove",s),document.removeEventListener("mouseup",t)},s=e=>{let t=e.clientX-i,s=e.clientY-r;o.style.setProperty("--drag-position",`${n+t}px ${l+s}px`)},o=e.currentTarget;let i=e.clientX,r=e.clientY,n=+getComputedStyle(o).translate.split(" ")[0].replace("px",""),l=+getComputedStyle(o).translate.split(" ")[1].replace("px","");o.addEventListener("mousemove",s),document.addEventListener("mouseup",t)}));const n=t=>{e.style.setProperty("--set-scale",+t.currentTarget.textContent.replace("%","")/100),e.style.setProperty("--drag-position","1px 1px"),o.querySelector("span").textContent=t.currentTarget.textContent};o.addEventListener("click",(e=>{i.classList.contains("open")?(i.classList.remove("open"),setTimeout((()=>{i.style.display="none"}),300)):(i.style.display="block",setTimeout((()=>{i.classList.add("open")}),50))})),[...i.children].forEach((e=>{e.addEventListener("click",n)}))})(),(()=>{const e=document.querySelector("#header-panel"),t=document.querySelectorAll(".menu__top-block");addEventListener("scroll",(()=>{0!=scrollY?(e.classList.add("scrolled"),t.forEach((e=>{e.classList.add("scrolled")}))):(e.classList.remove("scrolled"),t.forEach((e=>{e.classList.remove("scrolled")})))}))})(),(()=>{const e=document.querySelectorAll(".gallery-item"),t=document.querySelector(".workspace__canvas img");e.forEach((s=>{s.addEventListener("click",(s=>{const o=s.currentTarget;e[0].parentElement.querySelector(".selected").classList.remove("selected"),o.classList.add("selected"),t.setAttribute("src",o.children[0].src)}))}))})(),(()=>{let e=document.querySelectorAll(".tab-list__tab");const t=document.querySelector("#add-step-button"),s=document.querySelector(".steps__wrapper"),o=t=>{if(e=document.querySelectorAll(".tab-list__tab"),t.currentTarget.classList.contains("selected"))return void t.currentTarget.setAttribute("contenteditable","true");t.currentTarget.parentElement.querySelector(".selected").removeAttribute("contenteditable"),t.currentTarget.parentElement.querySelector(".selected").classList.remove("selected"),t.currentTarget.classList.add("selected");let o=t.currentTarget.id.split("_")[1];s.querySelector(".open").classList.remove("open"),console.log("here"),s.children[o-1].classList.add("open")};e.forEach((e=>{e.addEventListener("click",o)})),t.addEventListener("click",(e=>{let t=document.querySelectorAll(".tab-list__tab").length;const i=document.createElement("li");i.classList.add("tab-list__tab"),i.id=`steps-tab_${t+1}`,i.textContent=`Step ${t+1}`,i.addEventListener("click",o),e.currentTarget.insertAdjacentElement("beforebegin",i);const r=document.createElement("div");r.classList.add("tab-list__step-content"),r.id=`steps-content_${t+1}`,s.insertAdjacentElement("beforeend",r),i.click()}))})(),e.forEach((e=>{e.addEventListener("click",s)})),(()=>{const e=document.querySelectorAll(".custom-option__add-layer-button"),t=document.querySelectorAll(".dropdown_select-from"),s=document.querySelector(".layer-manager__button#edit-layers"),o=e=>e.closest(".custom-option").querySelector(".custom-option__add-layer-dropdown"),i=e=>{o(e.currentTarget).classList.add("open")},r=e=>{o(e.currentTarget).classList.remove("open"),s.click()};e.forEach((e=>{e.addEventListener("click",i)})),t.forEach((e=>{e.addEventListener("click",r)}))})(),document.querySelectorAll(".custom-option__collapse-button").forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest(".custom-option");console.log(t),t.classList.contains("collapsed")?t.classList.remove("collapsed"):t.classList.add("collapsed")}))})),window.Layers=o,o.init()})();